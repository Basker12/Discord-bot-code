import discord
from discord.ext import commands
import asyncio
import random

client = commands.Bot(command_prefix = '!')
#^ The command prefix can be changed to your liking, it
doesn't have to be a !.
client.remove_command('help')

@client.event
async def on_ready():
    await client.change_presence(activity=discord.Game(name="#Whatever you like"))

    print("Weenur pod is ready!")

@client.command(pass_context=True)
async def coins(ctx):
    coins = 5
    await ctx.send(f"Your number of coins is: {coins}")

@client.command(pass_context=True)
async def members(ctx):
    member_count = 0
    for member in ctx.guild.members:
        member_count += 1
    await ctx.send(ctx.guild.member_count)

@client.command(aliases = ['user', 'info'])
async def who_dis(ctx, member : discord.Member):
    embed = discord.Embed(title = member.name, color = discord.Colour.from_rgb(255,255,0))
    embed.add_field(name = "ID", value = member.id, inline = True)
    embed.set_thumbnail(url = member.avatar_url)
    await ctx.send(embed=embed)

@client.command(aliases = ['helpme'])
async def help(ctx):
    embed = discord.Embed(
        title = 'Weenur pod helpline!',
        colour = discord.Colour.from_rgb(255,255,0)
    )

    embed.set_thumbnail(url = 'https://cdn.discordapp.com/attachments/814574712126308396/816626948545314866/feck_off.png')

    embed.add_field(name = '!members', value = 'Lets you see the amount of members in the server.', inline = False)
    embed.add_field(name = '!coins', value = ' Shows your balance of coins.', inline = False)
    embed.add_field(name = '!music_help', value = """Lets you play a song from YouTube, write !music_help for all the 
        music commands.""", inline = False)
    embed.add_field(name = '!8ball', value= """Lets you play a game with an 8ball. Write !8ball <your question> and he shall give you the words of wisdom""", inline = False)
    embed.add_field(name = '!gaming_quiz', value = """Lets you play a gaming quiz. To answer the question you must write !answer_ <quiz number> and then your answer, this also will be a number from 1-5. Theres five questions in the quiz.""", inline = False)
    embed.add_field(name = '!info', value = """Lets you see the selected discord user's id, there name and there pfp. Write !info @ <user> to see there info.""", inline = False)

@client.command(aliases = ['music_help'])
async def music(ctx):
    embed = discord.Embed(
        title = 'This is the music helpline!',
        colour = discord.Colour.from_rgb(255,255,0)

    )

    embed.set_thumbnail(url = 'https://cdn.discordapp.com/attachments/814574712126308396/816640533064712192/wpcmimg.png')

    embed.add_field(name = '!join', value = """This makes the bot join the voice channel you're in.""", inline = False)
    embed.add_field(name = '!play <URL>', value = 'Lets you play a song from YouTube.', inline = False)
    embed.add_field(name = '!leave', value = 'Stops the current song from being played and disconnects the bot.', inline = False)

    await ctx.send(embed=embed)
    
@client.command(aliases = ['8ball', 'skeleseer'])
async def ball_8(ctx, *, question):
    embed = discord.Embed(
        colour = discord.Colour.from_rgb(255,255,0)
    )
    ball_8_words = ['As i see it, yes',
            'Ask again later',
            'Better not tell you now',
            'Cannot predict now',
            'Dont count on it',
            'It is certain',
            'It is decidedly so',
            'Most likely',
            'My sources say no',
            'Outlook not so good',
            'Reply hazy, try again',
            'Signs point to yes',
            'Very doubtful',
            'Without a doubt',
            'Yes',
            'No',
            'Yes - definitely',
            'You may rely on it']
    
    embed.set_author(name = '8 Ball', icon_url = 'https://cdn.discordapp.com/attachments/814574712126308396/817150768179183636/epic_8_ball_v4.png')
    embed.add_field(name = f'Your question is: {question}', value = f'The answer is: {random.choice(ball_8_words)}', inline = False)

    await ctx.send(embed=embed)

@client.command(pass_context = True)
async def gaming_quiz(ctx):
    embed = discord.Embed(
        title = 'Question 1',
        colour = discord.Colour.from_rgb(255,255,0)
    )

    embed.set_thumbnail(url = 'https://cdn.discordapp.com/attachments/814574712126308396/818166200068210708/220px-TLOU_P2_Box_Art_2.png')
    embed.add_field(name = 'Who made the Last of us part 2?', value = """1: Santa Monica Studios
    2: CD Project Red
    3: Naughty Dog
    4: 343 Studios
    5: From Software""", inline = False)

    await ctx.send (embed=embed)
    
@client.command(pass_context = True)
async def answer_1(ctx, *, a_1):
    if a_1 == '1':
        await ctx.send("Your answer is in-correct üëé")
    elif a_1 == '2':
        await ctx.send("Your answer is in-correct üëé")
    elif a_1 == '3':
        await ctx.send("Your answer is correct! üëç")
    elif a_1 == '4':
        await ctx.send("Your answer is in-correct üëé")
    elif a_1 == '5':
        await ctx.send("Your answer is in-correct üëé")
        
@client.command(pass_context = True, aliases = ['vc'])
async def join(ctx):
    channel = ctx.message.author.voice.channel
    if not channel:
        await ctx.send("You are not connected to a voice channel")
        return
    voice = discord.utils.get(client.voice_clients, guild = ctx.guild)
    if voice and voice.is_connected():
        await voice.move_to(channel)
        await ctx.send("Joining the VC")
    else:
        voice = await channel.connect()

@client.command(pass_context = True)
async def leave(ctx):
    channel = ctx.message.author.voice.channel
    voice = discord.utils.get(client.voice_clients, guild = ctx.guild)

    if voice and voice.is_connected():
        await voice.disconnect()

@client.command(pass_context = True)
async def play(ctx, url : str):
    song_there = os.path.isfile("song.mp3")
    try:
        if song_there:
            os.remove("song.mp3")
    except PermissionError:
        await ctx.send("Wait for the current song to finish playing or write !leave")
        return
        
    voice = discord.utils.get(client.voice_clients, guild = ctx.guild)

    ydl_opts = {
        'format': 'bestaudio/best',
        'postprocessors': [{
            'key': 'FFmpegExtractAudio',
            'preferredcodec': 'mp3',
            'preferredquality': '192',
        }],
    }
    with youtube_dl.YoutubeDL(ydl_opts) as ydl:
        ydl.download([url])
    for file in os.listdir("./"):
        if file.endswith(".mp3"):
            os.rename(file, 'song.mp3')
    voice.play(discord.FFmpegPCMAudio('song.mp3'))

client.run('Bot token here') # NEVER get rid of this line of code
